# WeChatFerry Python å®¢æˆ·ç«¯
[![PyPi](https://img.shields.io/pypi/v/wcferry.svg)](https://pypi.python.org/pypi/wcferry) [![Downloads](https://static.pepy.tech/badge/wcferry)](https://pypi.python.org/pypi/wcferry) [![Documentation Status](https://readthedocs.org/projects/wechatferry/badge/?version=latest)](https://wechatferry.readthedocs.io/zh/latest/?badge=latest)

|[ğŸ“– æ–‡æ¡£](https://wechatferry.readthedocs.io/)|[ğŸ“º è§†é¢‘æ•™ç¨‹](https://mp.weixin.qq.com/s/APdjGyZ2hllXxyG_sNCfXQ)|[ğŸ™‹ FAQ](https://mp.weixin.qq.com/s/vAGpn1C9stI8Xzt1hUJhLA)|
|:-:|:-:|:-:|

ğŸ¤–ç¤ºä¾‹æœºå™¨äººæ¡†æ¶ï¼š[WeChatRobot](https://github.com/lich0821/WeChatRobot)ã€‚

## å¿«é€Ÿå¼€å§‹
```sh
pip install --upgrade wcferry
```

### Demoï¼š
```py
#! /usr/bin/env python3
# -*- coding: utf-8 -*-

import logging
from threading import Thread
from time import sleep

from wcferry import Wcf

logging.basicConfig(level='DEBUG', format="%(asctime)s %(message)s")
LOG = logging.getLogger("Demo")


def process_msg(wcf: Wcf):
    """å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯"""
    while wcf.is_receiving_msg():
        try:
            msg = wcf.get_msg()
        except Exception as e:
            continue

        LOG.info(msg)  # ç®€å•æ‰“å°


def main():
    LOG.info("Start demo...")
    wcf = Wcf(debug=True)             # é»˜è®¤è¿æ¥æœ¬åœ°æœåŠ¡

    sleep(5)  # ç­‰å¾®ä¿¡åŠ è½½å¥½ï¼Œä»¥å…ä¿¡æ¯æ˜¾ç¤ºå¼‚å¸¸
    LOG.info(f"å·²ç»ç™»å½•: {True if wcf.is_login() else False}")
    LOG.info(f"wxid: {wcf.get_self_wxid()}")

    # å…è®¸æ¥æ”¶æ¶ˆæ¯
    # wcf.enable_recv_msg(LOG.info) # deprecated

    # å…è®¸æ¥æ”¶æ¶ˆæ¯
    wcf.enable_receiving_msg(pyq=True)  # åŒæ—¶å…è®¸æ¥æ”¶æœ‹å‹åœˆæ¶ˆæ¯
    Thread(target=process_msg, name="GetMessage", args=(wcf,), daemon=True).start()

    # wcf.disable_recv_msg() # å½“éœ€è¦åœæ­¢æ¥æ”¶æ¶ˆæ¯æ—¶è°ƒç”¨
    sleep(5)
    ret = wcf.send_text("Hello world.", "filehelper")
    LOG.info(f"send_text: {ret}")

    sleep(5)
    # éœ€è¦ç¡®ä¿å›¾ç‰‡è·¯å¾„æ­£ç¡®ï¼Œå»ºè®®ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼ˆä½¿ç”¨åŒæ–œæ \\ï¼‰
    ret = wcf.send_image("https://raw.githubusercontent.com/lich0821/WeChatFerry/master/assets/QR.jpeg", "filehelper")
    LOG.info(f"send_image: {ret}")

    sleep(5)
    # éœ€è¦ç¡®ä¿æ–‡ä»¶è·¯å¾„æ­£ç¡®ï¼Œå»ºè®®ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼ˆä½¿ç”¨åŒæ–œæ \\ï¼‰
    ret = wcf.send_file("https://raw.githubusercontent.com/lich0821/WeChatFerry/master/README.MD", "filehelper")
    LOG.info(f"send_file: {ret}")

    sleep(5)
    LOG.info(f"Message types:\n{wcf.get_msg_types()}")
    LOG.info(f"Contacts:\n{wcf.get_contacts()}")

    sleep(5)
    LOG.info(f"DBs:\n{wcf.get_dbs()}")
    LOG.info(f"Tables:\n{wcf.get_tables('db')}")
    LOG.info(f"Results:\n{wcf.query_sql('MicroMsg.db', 'SELECT * FROM Contact LIMIT 1;')}")

    # éœ€è¦çœŸæ­£çš„ V3ã€V4 ä¿¡æ¯
    # wcf.accept_new_friend("v3", "v4")

    # æ·»åŠ ç¾¤æˆå‘˜ï¼Œå¡«å†™æ­£ç¡®çš„ç¾¤ ID å’Œæˆå‘˜ wxid
    # ret = wcf.add_chatroom_members("chatroom id", "wxid1,wxid2,wxid3,...")
    # LOG.info(f"add_chatroom_members: {ret}")

    # åˆ é™¤ç¾¤æˆå‘˜ï¼Œå¡«å†™æ­£ç¡®çš„ç¾¤ ID å’Œæˆå‘˜ wxid
    # ret = wcf.del_chatroom_members("chatroom id", "wxid1,wxid2,wxid3,...")
    # LOG.info(f"add_chatroom_members: {ret}")

    sleep(5)
    wcf.refresh_pyq(0)  # åˆ·æ–°æœ‹å‹åœˆç¬¬ä¸€é¡µ
    # wcf.refresh_pyq(id)  # ä» id å¼€å§‹åˆ·æ–°æœ‹å‹åœˆ

    # ä¸€ç›´è¿è¡Œ
    wcf.keep_running()


if __name__ == "__main__":
    main()

```

|![ç¢²çŸ¿](https://gitee.com/lch0821/WeChatFerry/raw/master/assets/TEQuant.jpg)|![èµèµ](https://gitee.com/lch0821/WeChatFerry/raw/master/assets/QR.jpeg)|
|:-:|:-:|
|åå°å›å¤ `WeChatFerry` åŠ ç¾¤äº¤æµ|å¦‚æœä½ è§‰å¾—æœ‰ç”¨|

## ä¸€èµ·å¼€å‘
### é…ç½®ç¯å¢ƒ
```sh
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .env
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .env/Scripts/activate
# å‡çº§ pip
pip install --upgrade pip
# å®‰è£…ä¾èµ–åŒ…
pip install grpcio-tools pynng
```

### é‡æ–°ç”Ÿæˆ PB æ–‡ä»¶
```sh
# CMD
cd clients\python\wcferry
python -m grpc_tools.protoc --python_out=. --proto_path=..\..\..\WeChatFerry\rpc\proto\ wcf.proto

# GitBash
cd clients/python/wcferry
python -m grpc_tools.protoc --python_out=. --proto_path=../../../WeChatFerry/rpc/proto/ wcf.proto
```

## ç‰ˆæœ¬æ›´æ–°
### 39.0.2.1 (2023.08.01)
* å‘é€æ–‡ä»¶æ”¯æŒç½‘ç»œè·¯å¾„

<details><summary>ç‚¹å‡»æŸ¥çœ‹æ›´å¤š</summary>

### 39.0.2.0 (2023.07.16)
* è·å–æœ‹å‹åœˆæ¶ˆæ¯

ç‰ˆæœ¬å·ï¼š`w.x.y.z`ã€‚

å…¶ä¸­ï¼š
* `w` æ˜¯å¾®ä¿¡çš„å¤§ç‰ˆæœ¬å·ï¼Œå¦‚ `37` (3.7.a.a), `38` (3.8.a.a), `39` (3.9.a.a)
* `x` æ˜¯é€‚é…çš„å¾®ä¿¡çš„å°ç‰ˆæœ¬å·ï¼Œä» 0 å¼€å§‹
* `y` æ˜¯ `WeChatFerry` çš„ç‰ˆæœ¬ï¼Œä» 0 å¼€å§‹
* `z` æ˜¯å„å®¢æˆ·ç«¯çš„ç‰ˆæœ¬ï¼Œä» 0 å¼€å§‹

åŠŸèƒ½ï¼š

* æ£€æŸ¥ç™»å½•çŠ¶æ€
* è·å–ç™»å½•è´¦å·çš„ wxid
* è·å–æ¶ˆæ¯ç±»å‹
* è·å–æ‰€æœ‰è”ç³»äºº
* è·å–æ‰€æœ‰å¥½å‹
* è·å–æ•°æ®åº“
* è·å–æŸæ•°æ®åº“ä¸‹çš„è¡¨
* è·å–ç”¨æˆ·ä¿¡æ¯
* å‘é€æ–‡æœ¬æ¶ˆæ¯ï¼ˆå¯ @ï¼‰
* å‘é€å›¾ç‰‡ï¼ˆPython å®¢æˆ·ç«¯æ”¯æŒç½‘ç»œè·¯å¾„ï¼‰
* å‘é€æ–‡ä»¶ï¼ˆPython å®¢æˆ·ç«¯æ”¯æŒç½‘ç»œè·¯å¾„ï¼‰
* å…è®¸æ¥æ”¶æ¶ˆæ¯
* åœæ­¢æ¥æ”¶æ¶ˆæ¯
* æ‰§è¡Œ SQL æŸ¥è¯¢
* æ¥å—å¥½å‹ç”³è¯·
* æ·»åŠ ç¾¤æˆå‘˜
* åˆ é™¤ç¾¤æˆå‘˜
* è§£å¯†å›¾ç‰‡
* è·å–æœ‹å‹åœˆæ¶ˆæ¯
* æŸåŠŸèƒ½ï¼ˆBreaking Changeï¼‰

</details>
